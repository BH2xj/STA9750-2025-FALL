---
title: "Mini-Project #01: Gourmet Cheeseburgers Across the Globe: Exploring the Most Popular Programming on Netflix"
---

```{r}
if(!dir.exists(file.path("data", "mp01"))){
    dir.create(file.path("data", "mp01"), showWarnings=FALSE, recursive=TRUE)
}

GLOBAL_TOP_10_FILENAME <- file.path("data", "mp01", "global_top10_alltime.csv")

if(!file.exists(GLOBAL_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-global.tsv", 
                  destfile=GLOBAL_TOP_10_FILENAME)
}

COUNTRY_TOP_10_FILENAME <- file.path("data", "mp01", "country_top10_alltime.csv")

if(!file.exists(COUNTRY_TOP_10_FILENAME)){
    download.file("https://www.netflix.com/tudum/top10/data/all-weeks-countries.tsv", 
                  destfile=COUNTRY_TOP_10_FILENAME)
}

# data import and presentation GLOBAL_TOP_10
if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

GLOBAL_TOP_10 <- read_tsv(GLOBAL_TOP_10_FILENAME)

str(GLOBAL_TOP_10)

GLOBAL_TOP_10 <- GLOBAL_TOP_10 |>
    mutate(season_title = if_else(season_title == "N/A", NA, season_title))

str(GLOBAL_TOP_10)

# data import and presentation COUNTRY_TOP_10
# ?read_tsv
if(!require("tidyverse")) install.packages("tidyverse")
library(readr)
library(dplyr)

COUNTRY_TOP_10 <- read_tsv(
                      COUNTRY_TOP_10_FILENAME,
                      na = "N/A"
                      )
                      
str(COUNTRY_TOP_10)

# initial data exploration, large numbers, title case, drop the season_title, runtime

# install.packages("DT") 
library(DT)
GLOBAL_TOP_10 |> 
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE))
    
library(stringr)
format_titles <- function(df){
    colnames(df) <- str_replace_all(colnames(df), "_", " ") |> str_to_title()
    df
}

GLOBAL_TOP_10 |> 
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views')) 
    
    
GLOBAL_TOP_10 |> 
    select(-season_title) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))
    
GLOBAL_TOP_10 |> 
    mutate(`runtime_(minutes)` = round(60 * runtime)) |>
    select(-season_title, 
           -runtime) |>
    format_titles() |>
    head(n=20) |>
    datatable(options=list(searching=FALSE, info=FALSE)) |>
    formatRound(c('Weekly Hours Viewed', 'Weekly Views'))
    
```


1. Netflix operates in 94 countries.

```{r}
COUNTRY_TOP_10 |>
    group_by(country_name) |>
    summarize(number = n())
    
```



2. The non-English-language film "All Quiet on the Western Front" has spent the most cumulative weeks in the global top 10. It spent 23 weeks.

```{r}
GLOBAL_TOP_10 |> filter( category == "Films (Non-English)") |>
                           slice_max(cumulative_weeks_in_top_10, n=1)

```



3. The film "Pushpa 2: The Rule (Reloaded Version)" is the longest film (English or non-English) to have ever appeared in the Netflix global Top 10. It has 223.998 minutes.

```{r}

GLOBAL_TOP_10 |> filter(category == "Films (Non-English)" | category == "Films (English)") |>
                           slice_max(runtime, n=1) |>
                           mutate(runtime = runtime * 60)
```



4. For each of the four categories, TV (English) program "Stranger Things" has the most total hours of global viewership.

```{r}
GLOBAL_TOP_10 |>
    group_by(category, show_title) |>
    summarize( weekly_hours_viewed_sum = sum (weekly_hours_viewed, na.rm=TRUE) ) |>
    mutate(weekly_hours_viewed_sum = weekly_hours_viewed_sum / 60) |>
    slice_max(weekly_hours_viewed_sum, n=1)
    
   
```



5. The TV show "Money Heist" had the longest run in a countryâ€™s Top 10. This run lasts 127 weeks in Pakistan.

```{r}
COUNTRY_TOP_10 |>
    filter(category == "TV") |>
    slice_max(cumulative_weeks_in_top_10, n=1)
    
```



6. Netflix provides over 200 weeks of service history for all but Russia. It ceased operations in Russia on Feb 27th, 2022.

```{r}
COUNTRY_TOP_10 |>
    group_by(country_name) |>
    
    summarize(service_of_weeks = n_distinct(week),
              last_week = max(week)) |>
    filter(service_of_weeks < 200)

```



7. The total viewership of the TV show Squid Game are 5048300000 hours watched across all three seasons.

```{r}
GLOBAL_TOP_10 |>
    filter(category == "TV (English)" | category == "TV (Non-English)") |>
    filter(show_title == "Squid Game") |>
    summarize( weekly_hours_viewed_sum = sum (weekly_hours_viewed, na.rm=TRUE) )

```


8. The movie Red Notice receive approximately 201732203 views in 2021.

```{r}
GLOBAL_TOP_10 |>
    filter(show_title == "Red Notice") |>
    filter(year(week) == "2021") |>
    summarize( weekly_views = sum(weekly_hours_viewed) / (1 + 58/60) )

```



9. 45 Films reached Number 1 in the US but did not originally debut there. The most recent film to pull this off is "Unknown Number: The High School Catfish".

```{r}

COUNTRY_TOP_10 |>
     filter(country_iso2 == "US", category == "Films") |>
     group_by(show_title) |>
     summarize(debut_week = min(week),
               debut_rank = weekly_rank[week == min(week)],
               reached_num1 = any(weekly_rank == 1),
               ) |>
     filter(reached_num1, debut_rank != 1) |>
     slice_max(debut_week, n=1)

```




10. "Emily in Paris" hit the top 10 in the most countries in its debut week and it charted 94 countries.

```{r}
COUNTRY_TOP_10 |>
     filter(category == "TV") |>
     group_by(show_title) |>
     mutate(debut_week = min(week)) |>
     filter(week == debut_week) |>
     summarize(debut_num_of_countries = n_distinct(country_name)) |>
      slice_max(debut_num_of_countries, n=1)
     

```




